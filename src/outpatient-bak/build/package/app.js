Ext.define("RaxaEmr.Outpatient.model.patientlist",{extend:"Ext.data.Model",config:{fields:["firstName","lastName","city","state","disease","noofvisits",{name:"lastvisit",type:"date",},"nameofdoc","id","age","urgency","image"]}});Ext.define("RaxaEmr.Outpatient.model.Grid",{extend:"Ext.data.Model",config:{fields:["height","weight","bmi","bp","pulse","resrate","temp","oxysat"]}});Ext.define("RaxaEmr.Outpatient.model.medicationhistory",{extend:"Ext.data.Model",config:{fields:["drugname","duration","lastfilled","prescriber","drugreaction","dosage","routeofadministration"]}});Ext.define("RaxaEmr.Outpatient.model.refertodoc",{extend:"Ext.data.Model",config:{fields:["docname","opdno"]}});Ext.define("RaxaEmr.Outpatient.model.labresulthistory",{extend:"Ext.data.Model",config:{fields:["labtesttype","laborderno","specimenid","labtestdate"]}});Ext.define("RaxaEmr.Outpatient.model.drugpanel",{extend:"Ext.data.Model",config:{fields:["drugname","strength","instruction","frequency","routeofadministration","duration"]}});Ext.define("RaxaEmr.Outpatient.model.cheifcomplain",{extend:"Ext.data.Model",config:{fields:["complain","id","duration"]}});Ext.define("RaxaEmr.Outpatient.model.sign",{extend:"Ext.data.Model",config:{fields:["sign","id","type"]}});Ext.define("RaxaEmr.Outpatient.model.diagnosis",{extend:"Ext.data.Model",config:{fields:["sign","id","type"]}});Ext.define("RaxaEmr.Outpatient.model.diagnosedDisease",{extend:"Ext.data.Model",config:{fields:["complain","id","duration"]}});Ext.define("RaxaEmr.Outpatient.model.druglist",{extend:"Ext.data.Model",config:{fields:[{name:"drug",type:"string",mapping:"name"},{name:"uuid",type:"string",mapping:"uuid"}],}});Ext.define("RaxaEmr.Outpatient.model.Observation",{extend:"Ext.data.Model",config:{fields:[{name:"uuid",type:"string"},{name:"display",type:"string"},{name:"obsDatetime",type:"string"},{name:"value",type:"string"},{name:"comment",type:"string"},{name:"order",type:"int"}]}});Ext.define("RaxaEmr.Outpatient.model.PostList",{extend:"Ext.data.Model",config:{fields:[{name:"id",persist:false},{name:"name",type:"string"},{name:"description",type:"string"},{name:"searchQuery",tyep:"string"},{name:"uuid",type:"string",persist:false}]}});Ext.define("RaxaEmr.Outpatient.view.Main",{extend:"Ext.tab.Panel",requires:["Ext.TitleBar","Ext.Video"],config:{tabBarPosition:"bottom",items:[{title:"Welcome",iconCls:"home",styleHtmlContent:true,scrollable:true,items:{docked:"top",xtype:"titlebar",title:"Welcome to Sencha Touch 2"},html:["You've just generated a new Sencha Touch 2 project. What you're looking at right now is the ","contents of <a target='_blank' href=\"app/view/Main.js\">app/view/Main.js</a> - edit that file ","and refresh to change what's rendered here."].join("")},{title:"Get Started",iconCls:"action",items:[{docked:"top",xtype:"titlebar",title:"Getting Started"},{xtype:"video",url:"http://av.vimeo.com/64284/137/87347327.mp4?token=1330978144_f9b698fea38cd408d52a2393240c896c",posterUrl:"http://b.vimeocdn.com/ts/261/062/261062119_640.jpg"}]}]}});var TEMP_TEST_THINGY=false;var myRecord;var opd_observations=new Array();Ext.define("RaxaEmr.Outpatient.controller.patientlist",{extend:"Ext.app.Controller",config:{refs:{main:"#mainview",contacts:"patientlist",contact:"#contact",name:"#name",docname:"#docname",urgency:"#urgency",lastvisit:"#lastvisit",refresh:"#refresh",mainTabs:"#maintabs",medicationHistory:"#medicationhistory",refToDocButton:"#reftodocbutton",confirmLabResultHistoryButton:"#confirmlabresulthistory",confirmMedicationHistoryButton:"#confirmmedicationhistory",confirmReferToDocButton:"#confirmrefertodoc",cheifcomplain:"#cheifComplain",labinfo:"#labinfo",examlist:"#examList",signlist:"#signList",deletecomlain:"#deleteComlain",addduration:"#addDuration",saveduration:"#saveDuration",adddruginlist:"#addDrugInList",addMoreDrug:"#addMoreDrug",submithistory:"#submit-history",submitdrugs:"#submitDrugs",adddiagnosis:"#addDiagnosis",submitdiagnosis:"#submitDiagnosis",labordersearchfield:"#labordersearchfield",medicationhistorysearchfield:"#medicationhistorysearchfield",medicationhistorysortbydrugname:"#medicationhistorysortbydrugname",medicationhistorysortbydrugreaction:"#medicationhistorysortbydrugreaction",reftodocsearchfield:"#reftodocsearchfield",reftodocsortbydocname:"#reftodocsortbydocname",reftodocsortbyopdno:"#reftodocsortbyopdno",signfilterbysearchfield:"#signfilterbysearchfield",referPatient:"#referpatient",diagnosisfilterbysearchfield:"#diagnosisfilterbysearchfield",diagnosislist:"#diagnosisList",deleteDiagnosed:"#deleteDiagnosed",drugfilterbysearchfield:"#drugfilterbysearchfield",druglist:"#drugList",vitalsGrid:"#vitalsGrid",},control:{main:{push:"onMainPush",pop:"onMainPop"},contacts:{itemtap:"onContactSelect"},signlist:{itemtap:"onSignListSelect"},diagnosislist:{itemtap:"onDiagnosisListSelect"},examlist:{itemtap:"onExamListSelect"},druglist:{itemtap:"onDrugListSelect",},name:{tap:"sortByName"},docname:{tap:"sortByDocName"},urgency:{tap:"sortByUrgency"},lastvisit:{tap:"sortByLastVisit"},refresh:{tap:"refreshList"},medicationhistorysortbydrugname:{tap:"medicationHistorySortByDrugName"},medicationhistorysortbydrugreaction:{tap:"medicationHistorySortByDrugReaction"},reftodocsortbydocname:{tap:"refToDocSortByDocName"},reftodocsortbyopdno:{tap:"refToDocSortByOpdno"},medicationHistory:{tap:"medicationHistoryAction"},refToDocButton:{tap:"refToDocButton"},labinfo:{tap:"labInfoAction"},searchfield:{clearicontap:"patientListOnSearchClearIconTap",keyup:"patientListOnSearchKeyUp"},labordersearchfield:{clearicontap:"labOrderOnSearchClearIconTap",keyup:"labOrderOnSearchKeyUp"},medicationhistorysearchfield:{clearicontap:"medicationHistoryOnSearchClearIconTap",keyup:"medicationHistoryOnSearchKeyUp"},reftodocsearchfield:{clearicontap:"refToDocOnSearchClearIconTap",keyup:"refToDocOnSearchKeyUp"},signfilterbysearchfield:{clearicontap:"signFilterByOnSearchClearIconTap",keyup:"signFilterByOnSearchKeyUp"},diagnosisfilterbysearchfield:{clearicontap:"diagnosisFilterByOnSearchClearIconTap",keyup:"diagnosisFilterByOnSearchKeyUp"},drugfilterbysearchfield:{clearicontap:"drugFilterByOnSearchClearIconTap",keyup:"drugFilterByOnSearchKeyUp"},cheifcomplain:{change:"addChiefComplain",},deletecomlain:{tap:"deleteComplain",},saveduration:{tap:"saveduration",},addduration:{tap:"addduration",},adddruginlist:{tap:"adddruginlist"},addMoreDrug:{tap:"adddruginlist"},submithistory:{tap:"submitHistory"},submitdrugs:{tap:"submitdrugs"},adddiagnosis:{tap:"addDiagnosis"},submitdiagnosis:{tap:"submitDiagnosis"},referPatient:{tap:"referPatient"},deleteDiagnosed:{tap:"deleteDiagnosed",},diagnosedList:{itemtap:"onDiagnosedListSelect"}}},init:function(){if(!TEMP_TEST_THINGY){this.getpatientlist()}},launch:function(){if(TEMP_TEST_THINGY){this.onContactSelect()}},getpatientlist:function(){var e=new Date();var c=Ext.create("RaxaEmr.Outpatient.model.PostList",{name:"Screener Encounter",description:"Patients encountered Screener on startDate="+Util.Datetime(e,24)+"&endDate="+Util.Datetime(e),searchQuery:"?encounterType="+localStorage.screenerUuidencountertype+"&startDate="+Util.Datetime(e,24)+"&endDate="+Util.Datetime(e)});var a=Ext.create("RaxaEmr.Outpatient.model.PostList",{name:"Outpatient Encounter",description:"Patients encountered Outpatient on startDate="+Util.Datetime(e,24)+"&endDate="+Util.Datetime(e),searchQuery:"?encounterType="+localStorage.outUuidencountertype+"&startDate="+Util.Datetime(e,24)+"&endDate="+Util.Datetime(e)});var b=0;this.createList(c,a,b)},createList:function(b,e,c){var a=Ext.create("RaxaEmr.Outpatient.store.PostLists");var d=Ext.create("RaxaEmr.Outpatient.store.PostLists");a.add(b);d.add(e);a.sync();d.sync();a.on("write",function(){c=c+1;if(c==2){this.finalPatientList(a,d)}},this);d.on("write",function(){c=c+1;if(c==2){this.finalPatientList(a,d)}},this)},finalPatientList:function(c,a){var b=Ext.create("RaxaEmr.Outpatient.store.PatientsList",{storeId:"patientStore"});b.getProxy().setUrl(this.getPatientListUrl(c.getData().getAt(0).getData().uuid,a.getData().getAt(0).getData().uuid,localStorage.screenerUuidencountertype));b.load({scope:this,callback:function(e,d,f){if(f){Ext.getCmp("contact").setStore(b)}else{Ext.Msg.alert("Error",Util.getMessageLoadError())}}});return b},getPatientListUrl:function(a,c,b){return(HOST+"/ws/rest/v1/raxacore/patientlist?inList="+a+"&notInList="+c+"&encounterType="+b)},onMainPush:function(a,b){if(b.xtype=="contact-show"){this.getContacts().deselectAll()}},onMainPop:function(a,b){this.buttonHide("confirmlabresulthistory");this.buttonHide("confirmmedicationhistory");this.buttonHide("confirmrefertodoc")},onContactSelect:function(f,c,e,a){if(!this.showContact){this.showContact=Ext.create("RaxaEmr.Outpatient.view.patient.more")}if(!TEMP_TEST_THINGY){this.showContact.setRecord(a)}this.getMain().push(this.showContact);if(TEMP_TEST_THINGY){return}myRecord=a;var b=function(m,l){var h=l.getGroups();for(var j=0;j<h.length;j++){if(h[j].name===m&&h[j].children.length){return h[j].children[0].data.value}}return"-"};console.log("load obsStore");var g=Ext.create("RaxaEmr.Outpatient.store.obs");console.log(g);g.getProxy().setUrl(HOST+"/ws/rest/v1/obs?patient="+myRecord.data.uuid);var d=this;g.load({callback:function(k,j,o){if(o){console.log(g);var h=["PULSE","TEMPERATURE (C)","BLOOD OXYGEN SATURATION","DIASTOLIC BLOOD PRESSURE","SYSTOLIC BLOOD PRESSURE","RESPIRATORY RATE"];item={};item.pulse="-";item.temp="-";item.oxysat="-";item.sbp="-";item.dbp="-";item.resrate="-";for(var l=0;l<h.length;l++){var n=b(h[l],g);console.log(h[l]+" is "+n);switch(h[l]){case"PULSE":item.pulse=n;break;case"TEMPERATURE (C)":item.temp=n;break;case"BLOOD OXYGEN SATURATION":item.oxysat=n;break;case"DIASTOLIC BLOOD PRESSURE":item.dbp=n;break;case"SYSTOLIC BLOOD PRESSURE":item.sbp=n;break;case"RESPIRATORY RATE":item.resrate=n;break;default:break}}item.bp=Ext.String.format("{0} / {1}",item.sbp,item.dbp);var m=Ext.getStore("Grid");m.clearData();m.add(item)}else{Ext.Msg.alert("Error",Util.getMessageLoadError())}}})},addChiefComplain:function(){var a=Ext.getCmp("cheifComplain");examlist=Ext.getCmp("examList");examlist.getStore().add({complain:a.getValue(),id:a.getValue()});Ext.getCmp("maintabs").setActiveItem(TABS.EXAMINATION)},onExamListSelect:function(d,b,c,a){Ext.getCmp("deleteComlain").setHidden(false);Ext.getCmp("addDuration").setHidden(false)},deleteComplain:function(){var a=Ext.getCmp("examList");selectedRecord=a.getSelection();a.getStore().remove(selectedRecord)},addduration:function(){this.getMain().push(Ext.getCmp("durationPicker"));Ext.getCmp("durationPicker").setHidden(false)},saveduration:function(){var c=Ext.getCmp("durationfield").getValue();var b=Ext.getCmp("examList");var a=b.getSelection();var c=Ext.getCmp("durationfield").getValue();var d=a[0].set("duration"," : "+c+" days");Ext.getCmp("durationPicker").setHidden(true);Ext.getCmp("durationfield").reset()},buttonAction:function(b,a){this.obj1=Ext.create(b);this.obj1.setRecord(myRecord);this.getMain().push(this.obj1);this.buttonShow(a)},buttonShow:function(b){var a=Ext.getCmp(b);if(!a.isHidden()){return}a.setHidden(false)},buttonHide:function(b){var a=Ext.getCmp(b);if(a.isHidden()){return}a.setHidden(true)},labInfoAction:function(){this.buttonAction("RaxaEmr.Outpatient.view.patient.labresulthistorypanel","confirmlabresulthistory")},medicationHistoryAction:function(){this.buttonAction("RaxaEmr.Outpatient.view.patient.medicationhistorypanel","confirmmedicationhistory")},refToDocButton:function(){this.buttonAction("RaxaEmr.Outpatient.view.patient.refertodocpanel","confirmrefertodoc");var a=Ext.create("Screener.store.Doctors",{storeId:"docStore"});a.load({scope:this,callback:function(c,b,d){if(d){Ext.getCmp("refToDocPanel").setStore(a)}else{Ext.Msg.alert("Error",Util.getMessageLoadError())}}})},sortBy:function(b,a){a.setSorters(b);a.load({scope:this,callback:function(d,c,e){if(e){}else{Ext.Msg.alert("Error",Util.getMessageLoadError())}}})},sortByName:function(){this.sortBy("display",this.getContact().getStore())},sortByDocName:function(){this.sortBy("nameofdoc",this.getContact().getStore())},sortByUrgency:function(){this.sortBy("urgency",this.getContact().getStore())},sortByLastVisit:function(){this.sortBy("lastvisit",this.getContact().getStore())},refreshList:function(){this.getContact().getStore().load({scope:this,callback:function(b,a,c){if(c){}else{Ext.Msg.alert("Error",Util.getMessageLoadError())}}})},medicationHistorySortByDrugName:function(){this.sortBy("drugname",Ext.getCmp("medicationhistorygrid").getStore())},medicationHistorySortByDrugReaction:function(){this.sortBy("drugreaction",Ext.getCmp("medicationhistorygrid").getStore())},refToDocSortByDocName:function(){this.sortBy("display",Ext.getCmp("refToDocPanel").getStore())},refToDocSortByOpdno:function(){this.sortBy("uuid",Ext.getCmp("refToDocPanel").getStore())},onSearchKeyUp:function(b,g,f,e){var h=g.getValue();var j=b;j.clearFilter();if(h){var c=h.split(" ");var d=[];var a;for(a=0;a<c.length;a++){if(!c[a]){continue}d.push(new RegExp(c[a],"i"))}j.filter(function(l){var k=[];for(a=0;a<d.length;a++){var n=d[a];var m=l.get(f).match(n)||l.get(e).match(n);k.push(m)}if(d.length>1&&k.indexOf(false)!=-1){return false}else{return k[0]}})}},onSearchClearIconTap:function(a){a.clearFilter()},patientListOnSearchKeyUp:function(a){this.onSearchKeyUp(this.getContact().getStore(),a,"display","uuid")},patientListOnSearchClearIconTap:function(){this.onSearchClearIconTap(this.getContact().getStore())},medicationHistoryOnSearchKeyUp:function(a){this.onSearchKeyUp(Ext.getCmp("medicationhistorygrid").getStore(),a,"drugname","drugreaction")},medicationHistoryOnSearchClearIconTap:function(){this.onSearchClearIconTap(Ext.getCmp("medicationhistorygrid").getStore())},labOrderOnSearchKeyUp:function(a){this.onSearchKeyUp(Ext.getCmp("labResultHistoryList").getStore(),a,"laborderno","specimenid")},labOrderOnSearchClearIconTap:function(){this.onSearchClearIconTap(Ext.getCmp("labResultHistoryList").getStore())},refToDocOnSearchKeyUp:function(a){this.onSearchKeyUp(Ext.getCmp("refToDocPanel").getStore(),a,"display","uuid")},refToDocOnSearchClearIconTap:function(){this.onSearchClearIconTap(Ext.getCmp("refToDocPanel").getStore())},onSignListSelect:function(e,c,d,b){var a=b.data.sign;e.getStore().remove(b);examlist=Ext.getCmp("examList");examlist.getStore().add({complain:a,id:a,})},signFilter:function(){var e=Ext.getCmp("signFilter").getValue();var b=Ext.getCmp("signList").getStore();if(e){var d=e.split(" ");var a=[];var c;for(c=0;c<d.length;c++){if(!d[c]){continue}a.push(new RegExp(d[c],"i"))}b.filter(function(g){var f=[];for(c=0;c<a.length;c++){var j=a[c];var h=g.get("type").match(j);f.push(h)}if(a.length>1&&f.indexOf(false)!=-1){return false}else{return f[0]}})}},signFilterByOnSearchKeyUp:function(a){Ext.getCmp("signList").setHidden(false);Ext.getCmp("signList").getStore().load({scope:this,callback:function(c,b,d){if(d){}else{Ext.Msg.alert("Error",Util.getMessageLoadError())}}});this.onSearchKeyUp(Ext.getCmp("signList").getStore(),a,"sign","type");this.signFilter()},signFilterByOnSearchClearIconTap:function(){this.onSearchClearIconTap(Ext.getCmp("signList").getStore())},diagnosisFilterByOnSearchKeyUp:function(b,a){Ext.getCmp("diagnosisList").setHidden(false);Ext.getCmp("diagnosisList").getStore().load();this.onSearchKeyUp(Ext.getCmp("diagnosisList").getStore(),b,"sign","type");this.signFilter()},diagnosisFilterByOnSearchClearIconTap:function(){this.onSearchClearIconTap(Ext.getCmp("diagnosisList").getStore())},onDiagnosisListSelect:function(e,c,d,b){var a=b.data.sign;e.getStore().remove(b);diagnosislist=Ext.getCmp("diagnosedList");diagnosislist.getStore().add({complain:a,id:a,})},deleteDiagnosed:function(){var a=Ext.getCmp("diagnosedList");selectedRecord=examlist.getSelection();examlist.getStore().remove(selectedRecord)},onDiagnosedListSelect:function(d,b,c,a){Ext.getCmp("deleteDiagnosed").setHidden(false)},submitOpdEncounter:function(){var c=new Date();var b=Util.Datetime(c,Util.getUTCGMTdiff());var d=Ext.create("RaxaEmr.Outpatient.model.opdEncounter",{patient:myRecord.data.uuid,encounterType:localStorage.outUuidencountertype,encounterDatetime:b,provider:localStorage.loggedInUser,obs:opd_observations});var a=Ext.create("RaxaEmr.Outpatient.store.opdEncounterPost");a.add(d);a.sync();a.on("write",function(){Ext.Msg.alert("successfull")},this);Ext.getCmp("examList").getStore().removeAll()},drugFilterByOnSearchClearIconTap:function(){this.onSearchClearIconTap(Ext.getCmp("drugList").getStore())},drugFilterByOnSearchKeyUp:function(a){if(!Ext.getCmp("searchedDrugList")){Ext.create("Ext.Panel",{id:"searchedDrugList",items:[{height:475,xtype:"Drug-List",scrollable:true,hidden:false}],width:200,height:500,padding:10}).showBy(Ext.getCmp("drugfilterbysearchfield"),"tl-tr?")}else{Ext.getCmp("searchedDrugList").setHidden(false)}Ext.getCmp("drugList").getStore().load();this.onSearchKeyUp(Ext.getCmp("drugList").getStore(),a,"drug","uuid");this.signFilter()},onDrugListSelect:function(d,b,c,a){Ext.getCmp("drugfilterbysearchfield").setValue(a.data.drug);Ext.getCmp("searchedDrugList").setHidden(true)},addObservation:function(a,b){var c=new Date();opd_observations.push({person:myRecord.data.uuid,obsDatetime:c,concept:a,value:b})},submitHistory:function(){var b=new Date();var a=Ext.getCmp("tobaccoField").getValue()+" "+Ext.getCmp("tobaccoRouteofIntake").getValue()+" "+Ext.getCmp("tobaccoFrequency").getValue();this.addObservation(localStorage.patientHistoryUuidconcept,Ext.getCmp("patientHistory").getValue());this.addObservation(localStorage.pastMedicationHistoryUuidconcept,Ext.getCmp("pastMedicalHistory").getValue());this.addObservation(localStorage.alcoholIntakeUuidconcept,Ext.getCmp("alcoholField").getValue());this.addObservation(localStorage.tobaccoIntakeUuidconcept,a);this.addObservation(localStorage.otherHistoryUuidconcept,Ext.getCmp("otherHistory").getValue());this.addObservation(localStorage.familyHistoryUuidconcept,Ext.getCmp("familyHistory").getValue());Ext.getCmp("patientHistoryPanel").reset();Ext.getCmp("socialHistoryPanel").reset()},submitExamination:function(){var c=new Date();var b=Ext.getCmp("examList").getStore();var a=b.getCount();for(i=0;i<a;i++){this.addObservation(localStorage.examlistUuidconcept,b.getAt(i).data.complain+b.getAt(i).data.duration)}},addDiagnosis:function(){var c=new Date();var a;var b=Ext.getCmp("diagnosisCategory").getValue();if(b=="Neuro"){a=localStorage.neurologicalDiagnosisUuidconcept}else{if(b=="Cardio"){a=localStorage.cadiologicalDiagnosisUuidconcept}}this.addObservation(a,Ext.getCmp("diagnosisField").getValue()+" : "+Ext.getCmp("diagnosisNotes").getValue());Ext.getCmp("diagnosisForm").reset()},submitDiagnosis:function(){this.addDiagnosis();this.submitExamination();this.submitOpdEncounter()},adddruginlist:function(a){druglist=Ext.getCmp("orderedDrugGrid");if(Ext.getCmp("drugfilterbysearchfield").getValue()){druglist.getStore().add({drugname:Ext.getCmp("drugfilterbysearchfield").getValue(),strength:Ext.getCmp("drug-strength").getValue(),instruction:Ext.getCmp("drug-instruction").getValue(),frequency:Ext.getCmp("drug-frequency").getValue(),duration:Ext.getCmp("drug-duration").getValue(),routeofadministration:Ext.getCmp("drug-routeofadministration").getValue()});Ext.getCmp("drugaddform").reset();if(a.id!="addMoreDrug"){Ext.getCmp("drugForm").setHidden(true)}}else{Ext.Msg.alert("Invalid Form","Please complete the Drug Form");Ext.getCmp("treatment-panel").setActiveItem(TREATMENT.ADD)}if(Ext.getCmp("searchedDrugList")){Ext.getCmp("searchedDrugList").setHidden(true)}},submitdrugs:function(){concept=new Array();order=new Array();var d=0,b=0;var c=Ext.getCmp("drugList").getStore();var g=Ext.getCmp("drugList").getStore().getCount();g=g-1;for(i=0;i<=g;i++){var f=HOST+"/ws/rest/v1/concept?q=";concept.push(Ext.create("RaxaEmr.Outpatient.store.drugConcept"));concept[i].setProxy({type:"rest",url:f,headers:Util.getBasicAuthHeaders(),reader:{type:"json",rootProperty:"results"}});var e=new Date();var a=new Date(e.getFullYear(),e.getMonth(),e.getDate()+c.getAt(i).data.duration);order.push({patient:myRecord.data.uuid,drug:c.getAt(i).data.drug,startDate:e,autoExpireDate:a,dose:c.getAt(i).data.strength,quantity:c.getAt(i).data.duration,frequency:c.getAt(i).data.frequency,instructions:c.getAt(i).data.instruction,type:"drugorder"});if(order[i].instructions==""){order[i].instructions="-"}concept[i].load({scope:this,callback:function(m,l,p){if(p){d=d+1;if(d==g+1){for(var n=0;n<=g;n++){order[n].concept=concept[n].getAt(0).data.uuid}var o=Util.Datetime(e,Util.getUTCGMTdiff());var k=Ext.create("RaxaEmr.Outpatient.model.drugEncounter",{patient:myRecord.data.uuid,encounterType:localStorage.prescriptionUuidencountertype,encounterDatetime:o,provider:localStorage.loggedInUser,orders:order});var h=Ext.create("RaxaEmr.Outpatient.store.drugEncounter");h.add(k);h.sync();h.on("write",function(){Ext.Msg.alert("successfull")},this)}}else{Ext.Msg.alert("Error",Util.getMessageLoadError())}}})}c.removeAll()},referPatient:function(){var c=Ext.getCmp("refToDocPanel").getSelection();var e=c[0].data.person.uuid;var a=new Date();var d=Ext.create("Screener.model.encounterpost",{encounterDatetime:Util.Datetime(a,5.5),patient:myRecord.data.uuid,encounterType:localStorage.screenerUuidencountertype,provider:e});var b=Ext.create("Screener.store.encounterpost");b.getProxy().setUrl(HOST+"/ws/rest/v1/encounter/"+myRecord.data.encounters[0].uuid);b.add(d);b.sync();b.on("write",function(){Ext.Msg.alert("successful")},this)}});Ext.define("RaxaEmr.Outpatient.store.patientlist",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.patientlist",autoLoad:true,sorters:"firstName",proxy:{type:"ajax",url:"resources/data/patient.json"}}});Ext.define("RaxaEmr.Outpatient.store.Grid",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.Grid",autoLoad:true,proxy:{type:"ajax",url:"resources/data/property.json"}}});Ext.define("RaxaEmr.Outpatient.store.medicationhistory",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.medicationhistory",autoLoad:true,proxy:{type:"ajax",url:"resources/data/medicationhistory.json"}}});Ext.define("RaxaEmr.Outpatient.store.refertodoc",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.refertodoc",autoLoad:true,proxy:{type:"ajax",url:"resources/data/refertodoc.json"}}});Ext.define("RaxaEmr.Outpatient.store.labresulthistory",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.labresulthistory",autoLoad:true,proxy:{type:"ajax",url:"resources/data/labresulthistory.json"}}});Ext.define("RaxaEmr.Outpatient.store.drugpanel",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.drugpanel",autoLoad:true,}});Ext.define("RaxaEmr.Outpatient.store.cheifcomplain",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.cheifcomplain",autoLoad:true,}});Ext.define("RaxaEmr.Outpatient.store.sign",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.sign",proxy:{type:"ajax",url:"resources/data/sign.json",}}});Ext.define("RaxaEmr.Outpatient.store.diagnosis",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.diagnosis",proxy:{type:"ajax",url:"resources/data/diagnosis.json",}}});Ext.define("RaxaEmr.Outpatient.store.diagnosedDisease",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.diagnosedDisease",autoLoad:true,}});Ext.define("RaxaEmr.Outpatient.store.druglist",{extend:"Ext.data.Store",requires:["RaxaEmr.Outpatient.model.druglist"],config:{model:"RaxaEmr.Outpatient.model.druglist",fields:["drug","uuid"],proxy:{type:"rest",url:HOST+"/ws/rest/v1/drug?v=full",headers:Util.getBasicAuthHeaders(),reader:{type:"json",rootProperty:"results"}},autoLoad:true,}});Ext.define("RaxaEmr.Outpatient.store.PostLists",{requires:["RaxaEmr.Outpatient.model.PostList"],extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.PostList",proxy:{type:"ajax",url:HOST+"/ws/rest/v1/raxacore/patientlist",headers:Util.getBasicAuthHeaders(),reader:{type:"json"},writer:"json",}}});Ext.define("RaxaEmr.Outpatient.store.obs",{extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.Observation",proxy:{type:"rest",url:HOST+"/ws/rest/v1/obs?patient=85d0626e-e32e-4637-8143-2d6b600cbfe3",headers:Util.getBasicAuthHeaders(),reader:{type:"json",rootProperty:"results"}},grouper:{groupFn:function(a){var b=a.get("display").indexOf("=");return a.get("display").substr(0,b-1)},}}});Ext.define("RaxaEmr.Outpatient.view.patientlist",{extend:"Ext.List",xtype:"patientlist",id:"contact",config:{title:"Outpatient Department",cls:"x-contacts",ui:"round",items:[{xtype:"toolbar",docked:"top",items:[{xtype:"segmentedbutton",allowDepress:false,items:[{xtype:"button",ui:"normal",text:"Today's List",pressed:true,width:150,},{xtype:"button",text:"All Patients",width:150,},{xtype:"button",text:"Pending",width:150,}]},{xtype:"spacer"},{xtype:"searchfield",id:"searchfield",placeHolder:"Search..."}]},{xtype:"toolbar",docked:"top",items:[{xtype:"segmentedbutton",allowDepress:false,items:[{xtype:"button",width:130,text:"Name",id:"name"},{xtype:"button",width:130,text:"Doctor",id:"docname"},{xtype:"button",width:130,text:"Urgency",id:"urgency"},{xtype:"button",width:130,text:"Last Visit",id:"lastvisit"}]},{xtype:"spacer"},{xtype:"button",width:130,text:"Refresh",id:"refresh",action:"refreshList",align:"right"}]}],itemTpl:new Ext.XTemplate('<div class="headshot" style="background-image:url({image});"></div>','<div style="float:left;width:25%;">',"{display}","<span>Gender : {[this.gender(values.gender)]}</span>","<span>From : ----</span>","</div>",'<div style="float:left;width:25%;">',"<span>----</span>","<span>Disease : ----</span>","<span>Age : {age}</span>","</div>",'<div style="float:left;height:32px;width:32px;background-image:url(resources/images/urgency.png);">8</div>','<div style="float:right;width:25%;">',"<span>Last Visit : ----</span>","<span>No. of Visits : --</span>","<span>ID : ----</span>","</div>",{date:function(a){return a.encounters[0].encounterDatetime.split("T")[0]},gender:function(a){if(a=="M"){return"Male"}else{if(a=="F"){return"Female"}}}})}});Ext.define("RaxaEmr.Outpatient.model.Patients",{extend:"Ext.data.Model",config:{fields:[{name:"id",persist:false},{name:"uuid",type:"string"},{name:"display",type:"string"},{name:"gender",type:"string"},{name:"age",type:"int"},{name:"encounters",persist:false,model:"RaxaEmr.Outpatient.model.encounters"}]}});Ext.define("RaxaEmr.Outpatient.view.patient.labresulthistory",{extend:"Ext.dataview.List",xtype:"Lab-Result-History",config:{store:"labresulthistory",ui:"round",id:"labResultHistoryList",items:[{xtype:"toolbar",docked:"top",items:[{xtype:"segmentedbutton",margin:"0 0 0 10",allowDepress:false,items:[{xtype:"button",text:"Completed",pressed:true,width:150,},{xtype:"button",text:"Pending",width:150,}]},{xtype:"spacer"},{xtype:"searchfield",id:"labordersearchfield",placeHolder:"Search..."}]}],itemTpl:["<div>{labtesttype}/Lab Order No: {laborderno}</br>Specimen ID: {specimenid}</br>Date: {labtestdate}</div>"]}});Ext.define("RaxaEmr.Outpatient.view.patient.diagnosedlist",{extend:"Ext.dataview.List",xtype:"Diagnosed-List",config:{cls:"x-diagnosed",id:"diagnosedList",store:"diagnosedDisease",itemTpl:['<div id="{id}">',"<strong>{complain}</strong>","</div>"],items:[{xtype:"toolbar",docked:"top",items:[{xtype:"spacer"},{xtype:"button",ui:"plain",iconCls:"trash",iconMask:true,hidden:false,id:"deleteDiagnosed"}]}]},});Ext.define("RaxaEmr.Outpatient.view.patient.diagnosislist",{extend:"Ext.dataview.List",xtype:"Diagnosis-List",config:{cls:"x-exam",id:"diagnosisList",store:"diagnosis",itemTpl:['<div id="{id}">',"<strong>{sign}{duration}</strong>","</div>"]},});Ext.define("Ext.ux.touch.grid.feature.Feature",{extend:"Ext.mixin.Mixin",mixinConfig:{id:"feature"},initFeatures:function(e,j){var g=this;e=g.getFeatures(e,j);var h=0,c=e.length,d,b,a;if(!g._featuresCollection){g._featuresCollection=Ext.create("Ext.util.MixedCollection")}for(;h<c;h++){d=e[h];b={};if(typeof d==="object"){Ext.apply(b,d);d=b.ftype;delete b.ftype}b.grid=g;d=Ext.create(d,b);g.addCls(d.getExtraCls());if(d&&typeof d.init==="function"){g._featuresCollection.add(d);d.init(g);g.on("beforedestroy",g.destroyFeatures,g,{single:true})}}},destroyFeatures:function(){var b=this,a=b._featuresCollection;a.each(function(c){if(typeof c.onDestroy==="function"){c.onDestroy()}})},getFeatures:function(d,g){d=d||[];var e=0,a=d.length,c=[],b;for(;e<a;e++){b=d[e];if(b.launchFn===g){c.push(b)}}return c}});var HISTORY={PERSONAL:0,SOCIAL:1};Ext.define("RaxaEmr.Outpatient.view.patient.history",{extend:"Ext.Container",xtype:"history-panel",id:"history-panel",config:{layout:{type:"card"},title:"History",activeItem:0,items:[{xtype:"container",layout:{type:"hbox"},scrollable:"false",items:[{xtype:"formpanel",id:"patientHistoryPanel",scrollable:"false",flex:1,items:[{xtype:"fieldset",width:"100%",items:[{xtype:"textareafield",id:"patientHistory",label:"Patient History"},{xtype:"textareafield",id:"pastMedicalHistory",label:"Past Medical History",}]},{xtype:"button",ui:"forward",text:"Next",id:"next",handler:function(){Ext.getCmp("history-panel").setActiveItem(HISTORY.SOCIAL)}}]},{xtype:"container",width:60,items:[{xtype:"button",docked:"top",height:40,margin:"20 20 0 0",width:40,id:"labinfo",icon:"../outpatient/resources/images/labhistory.png",padding:"0 10 10 0"},{xtype:"button",docked:"top",height:40,id:"medicationhistory",margin:"10 20 0 0",width:40,icon:"../outpatient/resources/images/medicationhistory.png",padding:"0 10 10 0"}]}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"formpanel",flex:1,id:"socialHistoryPanel",scrollable:"false",items:[{xtype:"fieldset",title:"Social History",items:[{xtype:"selectfield",label:"Alcohol",valueField:"alcoholFrequency",displayField:"title",id:"alcoholField",store:{data:[{alcoholFrequency:"",title:""},{alcoholFrequency:"never",title:"None"},{alcoholFrequency:"daily",title:"Daily"},{alcoholFrequency:"occasional",title:"Occasional"},{alcoholFrequency:"experiencedWithdrawal",title:"Experienced Withdrawal"}]}},{xtype:"fieldset",baseCls:"x-form-fieldset-mod",margin:"0 0 0 0",layout:{type:"hbox"},items:[{xtype:"selectfield",label:"Tobacco",border:0,labelWidth:"56.25%",flex:16,valueField:"time",displayField:"title",id:"tobaccoField",store:{data:[{time:"",title:""},{time:"never",title:"Never"},{time:"present",title:"Present"},{time:"past",title:"Past"}]}},{xtype:"selectfield",border:0,flex:7,valueField:"way",id:"tobaccoRouteofIntake",displayField:"title",store:{data:[{way:"",title:""},{way:"Neither",title:"Neither"},{way:"oral",title:"Oral"},{way:"smoking",title:"Smoking"},{way:"both",title:"Both"}]}},{xtype:"selectfield",border:0,flex:7,valueField:"amount",id:"tobaccoFrequency",displayField:"title",store:{data:[{amount:"",title:""},{amount:"None",title:"None"},{amount:"occasional",title:"Occasional"},{amount:"heavy",title:"Heavy"}]}}]},{xtype:"textareafield",id:"otherHistory",label:"Other"}]},{xtype:"fieldset",items:[{xtype:"textareafield",id:"familyHistory",label:"Family History"}]},{xtype:"container",layout:{pack:"center",type:"hbox"},items:[{xtype:"button",margin:"0 10 0 10",ui:"confirm",text:"Submit",flex:1,id:"submit-history"}]}]},{xtype:"container",width:60,items:[{xtype:"button",docked:"top",height:40,id:"medicationhistory2",margin:"65 20 0 0",width:40,icon:"../outpatient/resources/images/medicationhistory.png",padding:"0 10 10 0",handler:function(){Ext.getCmp("medicationhistory").fireEvent("tap")}}]}]}]}});Ext.define("RaxaEmr.Outpatient.view.patient.dataPanel",{extend:"Ext.Container",xtype:"data-panel",id:"data-panel",config:{title:"Data",items:[]}});Ext.define("KineticToSencha",{mixins:["Ext.mixin.Observable"],config:{fullName:""},constructor:function(a){this.initConfig(a)},addDiagnosis:function(){this.fireEvent("clickAddDiagnosis")},clickDiagnosis:function(){this.fireEvent("clickOnDiagnosis")},saveLoadMask:function(){var a=function(){console.log("mask off");Ext.getCmp("opdPatientDataEntry").setMasked(false)};console.log("mask on");Ext.getCmp("opdPatientDataEntry").setMasked({xtype:"loadmask",message:"Saving...",modal:true});setTimeout(a,4000)}});g_diagnosis_text="";g_diagnosis_list="";var k2s=Ext.create("KineticToSencha",{listeners:{clickAddDiagnosis:function(){console.log("k2s: clickAddDiagnosis");console.log("k2s: NOTE ADDING DRUGS FOR NOW");var j="";var l=Ext.getStore("drugpanel");var g=l.getData();var b=g.getCount();if(b>0){j+="Medications: \n"}for(var h=0;h<b;h++){var f=g.getAt(h).getData();console.log(f.drugname||"");if(!f.drugname){continue}j+=("* "+f.drugname);var e=f.duration;if(e){j+=(" - "+e)}var c=f.strength;if(c){j+=(" - "+c)}var d=f.duration;if(d){j+=(" - "+d)}var k=f.frequency;if(k){j+=(" - "+k)}var a=f.instruction;if(a){j+=(" - "+a)}j+="\n"}console.log("display...",j);g_diagnosis_text=j;l.clearData();Ext.getCmp("drugForm").setHidden(false);Ext.getCmp("drugaddform").reset();Ext.getCmp("treatment-panel").setActiveItem(TREATMENT.ADD)},clickOnDiagnosis:function(){console.log("k2s: clickOnDiagnosis");console.log("k2s: NOTE ADDING DIAGNOSES FOR NOW");var e="";var b=Ext.getStore("diagnosedDisease");var d=b.getData();var f=d.getCount();if(f>0){e+="Diagnoses: \n"}for(var c=0;c<f;c++){var a=d.getAt(c).getData();console.log(a);console.log(a.complain||"");e+=("* "+a.complain+"\n")}console.log("display...",e);g_diagnosis_list=e;b.clearData();Ext.getCmp("diagnosis-panel").setHidden(false)}}});imageCount=0;var DRAWABLE_X_MIN=0;var DRAWABLE_X_MAX=700;var DIFF=144;var DRAWABLE_Y_MIN=240-DIFF;var DRAWABLE_Y_MAX=1024;var DEFAULT_MODE="draw";var STAGE_X=768;var STAGE_Y=1024;var HISTORY_BASE_X=DRAWABLE_X_MAX;var HISTORY_BASE_Y=DRAWABLE_Y_MIN+196;var HISTORY_ITEM_DIM=64;var CONTROL_BASE_X=DRAWABLE_X_MAX+8;var CONTROL_BASE_Y=DRAWABLE_Y_MIN-6;var CONTROL_ITEM_SPACING=3;var CONTROL_ITEM_DIM=52;var HIGH_Y_OFFSET=5;function isInDrawableArea(b,a){up={x:b,y:a};if((DRAWABLE_X_MIN<=up.x&&up.x<=DRAWABLE_X_MAX)&&(DRAWABLE_Y_MIN<=up.y&&up.y<=DRAWABLE_Y_MAX)){return true}else{return false}}var setupCanvas=function(){var c=DRAWABLE_Y_MIN;var h=DRAWABLE_Y_MIN;var v;var l=[];var g;var o=DEFAULT_MODE;var m=HISTORY_BASE_Y;layer=new Kinetic.Layer();loadedImageLayer=new Kinetic.Layer();linesLayer=new Kinetic.Layer();textLayer=new Kinetic.Layer();controlsLayer=new Kinetic.Layer();stage=new Kinetic.Stage({container:"container",width:STAGE_X,height:STAGE_Y});GloStage=stage;stage.add(layer);stage.add(linesLayer);stage.add(textLayer);stage.add(loadedImageLayer);stage.add(controlsLayer);moving=false;stage.on("mousedown touchstart",function(){r()});stage.on("mousemove touchmove",function(){s()});stage.on("mouseup",function(){k()});stage.on("touchend",function(){k()});function r(){var z=stage.getUserPosition();if(!z||!isInDrawableArea(z.x,z.y)||o!=="draw"){return}if(moving){moving=false;layer.draw()}else{l=[];g=stage.getUserPosition();l.push(g);v=new Kinetic.Line({points:l,stroke:"red",});linesLayer.add(v);moving=true}}function s(){var B=stage.getUserPosition();if(!B||!isInDrawableArea(B.x,B.y)){return}if(o!=="draw"){return}if(moving){var A=stage.getUserPosition();var z=A.x;var C=A.y;l.push(A);q(A);g=A;moving=true;linesLayer.drawScene()}}function k(){console.log("drag complete");var z=stage.getUserPosition();if(!z||!isInDrawableArea(z.x,z.y)){return}if(o!=="draw"){return}moving=false}function q(z){var A=z.y;if(A<c||c==undefined){c=A}if(A>h||h==undefined){h=A+HIGH_Y_OFFSET;console.log("hi = "+A)}}function j(){k2s.saveLoadMask();stage.toDataURL({callback:function(z){b("","yellow",z)}})}function b(A,z,E){if(!E){var B=new Kinetic.Rect({x:DRAWABLE_X_MAX,y:m,width:HISTORY_ITEM_DIM,height:HISTORY_ITEM_DIM,fill:z,stroke:"black",strokeWidth:4,draggable:false,});G(B,"");var F=new Kinetic.Text({x:DRAWABLE_X_MAX+8,y:m-(HISTORY_ITEM_DIM+(HISTORY_ITEM_DIM/2))+HISTORY_ITEM_DIM/3,fontSize:HISTORY_ITEM_DIM/3,fontFamily:"ComicSans",textFill:"white",text:A});F.on("click touchstart",function(){e("")});controlsLayer.add(F);controlsLayer.draw();return}else{var D=new Image();D.onload=function(){var H=C(D);G(H,E)};D.src=E;function C(H){var I=new Kinetic.Image({x:DRAWABLE_X_MAX,y:m,width:HISTORY_ITEM_DIM,height:HISTORY_ITEM_DIM,stroke:"black",strokeWidth:4,image:H});return I}function G(H,I){controlsLayer.add(H);controlsLayer.draw();H.on("click touchstart",function(){e(I)});m+=HISTORY_ITEM_DIM+(HISTORY_ITEM_DIM/2)}}}function e(A){console.log("loadImageFromPriorVisit");if(!A){console.log("no data url");loadedImageLayer.hide();linesLayer.removeChildren();textLayer.removeChildren();h=DRAWABLE_Y_MIN;stage.draw();return}else{var z=new Image();z.onload=function(){console.log("image loaded");var B=new Kinetic.Image({x:0,y:0,image:z,width:stage.getWidth(),height:stage.getHeight()});loadedImageLayer.add(B);loadedImageLayer.draw()};z.src=A;loadedImageLayer.show()}}background=new Kinetic.Rect({x:0,y:0,width:stage.getWidth(),height:stage.getHeight(),fill:"white"});layer.add(background);var d=new Image();d.onload=function(){console.log("image loaded");console.log(stage.getWidth(),stage.getHeight());var z=new Kinetic.Image({x:0,y:0,image:d,width:stage.getWidth(),height:880});layer.add(z);layer.draw()};var w="resources/images/background-768x880.png";d.src=w;b("new","green","");var y=[{handler:function(){console.log("mode = draw");o="draw"},image:"resources/images/pencil.png"},{handler:function(){console.log("disabled, for now, since eraser isnt working")},image:"resources/images/eraser.png"},{handler:function(){console.log("tapped save button");j()},image:"resources/images/save.png"}];function x(A,B){console.log(A);var z=new Image();z.onload=function(){var C=new Kinetic.Image({x:CONTROL_BASE_X,y:CONTROL_BASE_Y+B*(CONTROL_ITEM_DIM+CONTROL_ITEM_SPACING),width:CONTROL_ITEM_DIM,height:CONTROL_ITEM_DIM,stroke:"black",strokeWidth:1,image:z});C.on("click touchstart",A.handler);controlsLayer.add(C);controlsLayer.draw()};z.src=A.image}x(y[0],0);x(y[1],1);x(y[2],2);var a=new Image();a.onload=function(){var z=new Kinetic.Image({x:200,y:DRAWABLE_Y_MIN-40,width:128,height:30,stroke:"black",strokeWidth:1,image:a});z.on("click touchstart",function(){console.log("Bringing diagnoses modal window.");t()});controlsLayer.add(z);controlsLayer.draw()};a.src="resources/images/plus_diagnosis.png";var u=new Image();u.onload=function(){var z=new Kinetic.Image({x:350,y:DRAWABLE_Y_MIN-40,width:150,height:30,stroke:"black",strokeWidth:1,image:u});z.on("click touchstart",function(){p()});controlsLayer.add(z);controlsLayer.draw()};u.src="resources/images/plus_medication.png";function t(){console.log("add diagnosis");k2s.clickDiagnosis();n(g_diagnosis_list)}function p(){console.log("add diagnosis");k2s.addDiagnosis();n(g_diagnosis_text)}function n(z){if(z){f(z)}}function f(A){console.log("drawTextAtLowPoint");if(A.indexOf("Medications")>=0){bgFill="#44f"}else{if(A.indexOf("Diagnoses")>=0){bgFill="#f44"}else{bgFill="#eee"}}var z=new Kinetic.Text({x:20,stroke:"#555",strokeWidth:3,fill:bgFill,text:"",fontSize:14,fontFamily:"Calibri",textFill:"#000",padding:10,align:"left",fontStyle:"italic",shadow:{color:"black",blur:1,offset:[10,10],opacity:0.2},cornerRadius:10});z.setAttrs({y:h,text:A,fill:bgFill});console.log(z);textLayer.add(z);stage.draw();h+=(z.textHeight*z.textArr.length+1)+30}};Ext.define("RaxaEmr.Outpatient.view.patient.draw",{extend:"Ext.Container",xtype:"draw-panel",id:"drawPanel",config:{layout:"hbox",items:[{xtype:"container",id:"opdPatientDataEntry",width:STAGE_X,height:STAGE_Y,layout:"vbox",items:[{scroll:false,html:'<div id="container" ></div>'}],listeners:{painted:function(){console.log("painted");setupCanvas()}},}]},});Ext.define("RaxaEmr.Outpatient.view.patient.examinationlist",{extend:"Ext.dataview.List",xtype:"Examination-List",config:{cls:"x-exam",id:"examList",store:"cheifcomplain",itemTpl:['<div id="{id}">',"<strong>{complain}{duration}</strong>","</div>"],items:[{xtype:"toolbar",docked:"top",items:[{xtype:"spacer"},{xtype:"button",ui:"plain",iconCls:"locate",iconMask:true,hidden:false,id:"addDuration"},{xtype:"button",ui:"plain",iconCls:"trash",iconMask:true,hidden:false,id:"deleteComlain"}]}]},});Ext.define("RaxaEmr.Outpatient.view.patient.signlist",{extend:"Ext.dataview.List",xtype:"Sign-List",config:{cls:"x-exam",id:"signList",hidden:true,store:"sign",itemTpl:['<div id="{id}">',"<strong>{sign}{duration}</strong>","</div>"]},});Ext.define("RaxaEmr.Outpatient.view.patient.treatmentsummery",{extend:"Ext.dataview.List",xtype:"Treatment-Summery",id:"drugList",config:{store:"drugpanel",itemTpl:["<div>{drugname} {strength} mg</br>{frequency} {instruction}</br>Continue for {duration} days</div>"]}});Ext.define("Screener.store.druglist",{extend:"Ext.data.Store",config:{model:"Screener.model.druglist",proxy:{type:"rest",url:HOST+"/ws/rest/v1/drug?v=default",headers:Util.getBasicAuthHeaders(),reader:{type:"json",rootProperty:"results"}},autoLoad:true}});Ext.define("Screener.model.druglist",{extend:"Ext.data.Model",config:{fields:[{name:"value",type:"string",mapping:"uuid"},{name:"text",type:"string",mapping:"name"}]}});Ext.define("RaxaEmr.Outpatient.view.patient.druglist",{extend:"Ext.dataview.List",xtype:"Drug-List",config:{cls:"x-exam",id:"drugList",store:"druglist",itemTpl:['<div id="{id}">',"<strong>{drug}</strong>","</div>"]},});Ext.define("RaxaEmr.Outpatient.view.patient.drugform",{extend:"Ext.Container",xtype:"drug-panel",id:"drugForm",config:{centered:true,modal:true,hidden:true,floating:true,hideOnMaskTap:true,title:"Treatment",items:[{xtype:"container",width:500,layout:{type:"hbox"},items:[{xtype:"container",flex:1,items:[{xtype:"container",style:"border:solid #DADADA;",height:500,width:500,layout:{type:"fit"},items:[{xtype:"formpanel",flex:2,id:"drugaddform",scrollable:"false",items:[{xtype:"fieldset",items:[{xtype:"searchfield",id:"drugfilterbysearchfield",label:"Drug Name"},{xtype:"selectfield",label:"Strength",id:"drug-strength",valueField:"value",displayField:"title",store:{data:[{value:"",title:"",},{value:"100",title:"100mg"},{value:"200",title:"200mg"},{value:"500",title:"500mg"}]}},{xtype:"fieldset",baseCls:"x-form-fieldset-mod",margin:"0 0 0 0",layout:{type:"hbox"},items:[{xtype:"selectfield",label:"Frequency",border:0,labelWidth:"46.1538%",flex:13,id:"drug-frequency",valueField:"value",displayField:"title",store:{data:[{value:"",title:"",},{value:"Once Daily",title:"Once Daily"},{value:"Once Daily",title:"Twice Daily"},{value:"Once Daily",title:"Thrice Daily"}]}},{xtype:"selectfield",border:0,flex:7,id:"drug-instruction",valueField:"value",displayField:"title",store:{data:[{value:"",title:"",},{value:"Empty Stomach",title:"Empty Stomach",},{value:"Before Meals",title:"Before Meals",},{value:"With Meals",title:"With Meals",},{value:"After Meals",title:"After Meals",}]}}]},{xtype:"selectfield",label:"Route of Administration",id:"drug-routeofadministration",valueField:"value",displayField:"title",store:{data:[{value:"Oral",title:"Oral",},{value:"Injection",title:"Injection"}]}},{xtype:"textfield",id:"drug-duration",label:"Duration (days)",}]},{xtype:"container",layout:"hbox",items:[{xtype:"spacer",width:"8%"},{xtype:"button",ui:"confirm",text:"Done",id:"addDrugInList",flex:1,width:"40%",},{xtype:"spacer",width:"4%"},{xtype:"button",ui:"confirm",text:"Add More Drugs",id:"addMoreDrug",flex:2,width:"40%",},{xtype:"spacer",width:"8%"}]}]}]}]}]}]}});Ext.define("RaxaEmr.Outpatient.store.PatientsList",{requires:["RaxaEmr.Outpatient.model.Patients"],extend:"Ext.data.Store",config:{model:"RaxaEmr.Outpatient.model.Patients",proxy:{type:"ajax",url:HOST+"/ws/rest/v1/raxacore/patientlist/<uuid>?v=full",headers:Util.getBasicAuthHeaders(),reader:{type:"json",rootProperty:"patients"}}}});Ext.define("RaxaEmr.Outpatient.view.patient.labresulthistorypanel",{extend:"Ext.Container",xtype:"labresulthistorypanel",requires:["RaxaEmr.Outpatient.view.patient.labresulthistory"],config:{title:"Lab Results History",cls:"x-show-contact",layout:"vbox",items:[{id:"labcontent",tpl:['<div class="top">','<div style="float:left;width:50%;">','<div class="headshot" style="float:left;background-image:url({image});">',"</div>",'<div class="name" style="float:left;width:80%;">',"{display}","</br>","<span>From : New Delhi, India</span>","</br>","</div>","</div>",'<div style="float:left;width:50%;">','<div class="name_small" style="float:left;width:50%;">',"<span> Age : {age} </span>","<span>ID : 16736127</span>","</br>","</div>",'<div class="name_right" style="float:left;width:50%;">',"<h3>Dr.Arpana Jain</h3>","<span></span>","</div>","</div>","</div>"].join("")},{xtype:"Lab-Result-History",flex:1}],record:null},updateRecord:function(a){if(a){this.down("#labcontent").setData(a.data)}}});Ext.define("RaxaEmr.Outpatient.view.patient.diagnosis",{extend:"Ext.Container",xtype:"diagnosis-panel",requires:["RaxaEmr.Outpatient.view.patient.diagnosedlist","RaxaEmr.Outpatient.view.patient.diagnosislist"],id:"diagnosis-panel",config:{layout:{type:"vbox"},width:500,height:500,centered:true,modal:true,hidden:true,floating:true,hideOnMaskTap:true,title:"Diagnosis",items:[{xtype:"container",width:500,layout:{type:"hbox"},items:[{xtype:"container",flex:1,layout:{type:"vbox"},items:[{xtype:"formpanel",border:"0 0 1 0",padding:"0 0 0 0",style:"border:solid #DADADA;",scrollable:false,items:[{xtype:"selectfield",label:"Search In",hidden:true,id:"diagnosisFilter",border:"0 0 1 0",style:"border:solid #DADADA;",valueField:"filterBy",displayField:"title",store:{data:[{filterBy:"all",title:"All",}]}},{xtype:"searchfield",id:"diagnosisfilterbysearchfield",}]},{xtype:"Diagnosis-List",flex:1,}]},{xtype:"container",flex:1,items:[{xtype:"container",margin:"0 0 20 0",border:"0 0 0 3",style:"border:solid #DADADA;",height:476,layout:{type:"fit"},items:[{xtype:"Diagnosed-List",}]}]}]}]}});Ext.define("Ext.ux.touch.grid.View",{extend:"Ext.dataview.DataView",xtype:"touchgridpanel",requires:["Ext.ux.touch.grid.feature.Feature"],mixins:["Ext.ux.touch.grid.feature.Feature"],config:{columns:[],cls:"touchgridpanel",header:{xtype:"toolbar",docked:"top",cls:"x-grid-header"},itemTpl:false},constructor:function(a){var c=this,b=c.features=a.features||c.config.features||c.features;if(typeof c.initFeatures==="function"&&typeof a.features==="object"){c.initFeatures(b,"constructor")}c.callParent([a]);c.setWidth(c._buildWidth())},initialize:function(){var a=this;a.callParent();if(typeof a.initFeatures==="function"&&typeof a.features==="object"){a.initFeatures(a.features,"initialize")}},applyColumns:function(a){var e=0,b=a.length,d=[];for(;e<b;e++){d.push(Ext.merge({},a[e]))}return d},refreshScroller:function(){var a=this.getScrollable().getScroller();a.refresh()},applyHeader:function(a){Ext.apply(a,{docked:"top",cls:"x-grid-header"});return Ext.factory(a,Ext.Toolbar)},updateHeader:function(a){this.insert(0,a)},_buildWidth:function(){var h=this,d=h.getColumns(),f=0,g=d.length,j=0,k=false,e=this.getDefaults()||{},b,a;for(;f<g;f++){b=d[f];a=b.width||e.column_width;if(!Ext.isNumber(a)){k=true;break}j+=a}return k?undefined:j},_defaultRenderer:function(a){return a},applyItemTpl:function(a){if(!a){a=this._buildTpl(this.getColumns(),false)}if(!(a instanceof Ext.XTemplate)){a=Ext.create("Ext.XTemplate",a.tpl,a.renderers)}return a},updateItemTpl:function(){var b=this.getHeader(),a=this._buildTpl(this.getColumns(),true);b.setHtml(a.tpl)},_buildTpl:function(g,k){var n=[],q=0,r=g.length,a=Ext.baseCSSPrefix,e={},h=this.getDefaults()||{},f,m,l,s,j,d,p,b,o;for(;q<r;q++){f=g[q];m=f.hidden;if(m){continue}l=[a+"grid-cell"];s=[];j=['dataindex="'+f.dataIndex+'"'];d=f.width||h.column_width;p=f.renderer||this._defaultRenderer;b=f.dataIndex+"_renderer";if(k){l.push(a+"grid-cell-hd");o=f.header}else{o="{[this."+b+"(values."+f.dataIndex+", values)]}";if(f.style){s.push(f.style)}if(f.cls){l.push(f.cls)}e[b]=p}if(d){s.push("width: "+d+(Ext.isString(d)?"":"px")+";")}if(s.length>0){j.push('style ="'+s.join(" ")+'"')}n.push('<div class="'+l.join(" ")+'" '+j.join("")+">"+o+"</div>")}n=n.join("");return{tpl:n,renderers:e}},getColumn:function(b){var e=this,a=e.getColumns(),g=0,f=a.length,d;for(;g<f;g++){d=a[g];if(d.dataIndex===b){break}}return d},toggleColumn:function(a,c){var b=this.getColumns(),d=b[a];if(!Ext.isDefined(c)){c=!d.hidden}d.hidden=c;this.setItemTpl(null);this.refresh()},hideColumn:function(a){this.toggleColumn(a,true)},showColumn:function(a){this.toggleColumn(a,false)}});Ext.define("RaxaEmr.Outpatient.view.patient.Grid",{extend:"Ext.ux.touch.grid.View",xtype:"vitalsGrid",id:"vitalsGrid",requires:["Ext.ux.touch.grid.feature.Feature","Ext.field.Number","RaxaEmr.Outpatient.store.Grid"],config:{title:"Grid",store:"Grid",scrollable:"false",columns:[{header:"BP",dataIndex:"bp",width:"25%",cls:"centered-cell",renderer:function(a){if(a=="- / -"||a==undefined){return"-"}else{return a}}},{header:"Pulse",dataIndex:"pulse",width:"17%",cls:"centered-cell"},{header:"RespRate",dataIndex:"resrate",width:"25%",cls:"centered-cell"},{header:"Temp",dataIndex:"temp",width:"17%",cls:"centered-cell"},{header:"O2Sat",dataIndex:"oxysat",width:"16%",cls:"centered-cell"}]}});Ext.define("RaxaEmr.Outpatient.view.patient.medicationhistory",{extend:"Ext.ux.touch.grid.View",xtype:"Medication-History",requires:["Ext.ux.touch.grid.feature.Feature","Ext.field.Number","RaxaEmr.Outpatient.store.Grid"],config:{title:"Medication History",id:"medicationhistorygrid",store:"medicationhistory",items:[{xtype:"toolbar",docked:"top",items:[{xtype:"segmentedbutton",margin:"0 0 0 10",allowDepress:false,items:[{xtype:"button",text:"Sort By Drug Name",id:"medicationhistorysortbydrugname",pressed:true,width:200,},{xtype:"button",id:"medicationhistorysortbydrugreaction",text:"Sort By Drug Reaction",width:200,}]},{xtype:"spacer"},{xtype:"searchfield",id:"medicationhistorysearchfield",placeHolder:"Search..."}]}],columns:[{header:"Drug Name",dataIndex:"drugname",width:"10%",cls:"centered-cell",renderer:function(b,a){return"<span>"+b+"</span>"}},{header:"Duration",dataIndex:"duration",width:"10%",cls:"centered-cell",renderer:function(b,a){return"<span>"+b+"</span>"}},{header:"Last Filled",dataIndex:"lastfilled",width:"10%",cls:"centered-cell",},{header:"Prescriber",dataIndex:"prescriber",width:"15%",cls:"centered-cell"},{header:"Drug Reaction",dataIndex:"drugreaction",width:"20%",cls:"centered-cell",},{header:"Dosage",dataIndex:"dosage",width:"15%",cls:"centered-cell",},{header:"Route of Administration",dataIndex:"routeofadministration",width:"20%",cls:"centered-cell",}]}});Ext.define("RaxaEmr.Outpatient.view.patient.medicationhistorypanel",{extend:"Ext.Container",xtype:"Medication-History-Panel",requires:["RaxaEmr.Outpatient.view.patient.medicationhistory"],config:{title:"Medication-History",cls:"x-show-contact",layout:"vbox",items:[{id:"medicationhistorycontent",tpl:['<div class="top">','<div style="float:left;width:50%;">','<div class="headshot" style="float:left;background-image:url({image});">',"</div>",'<div class="name" style="float:left;width:80%;">',"{display}","</br>","<span>From : New Delhi, India</span>","</br>","</div>","</div>",'<div style="float:left;width:50%;">','<div class="name_small" style="float:left;width:50%;">',"<span> Age : {age} </span>","<span>ID : 16736127</span>","</br>","</div>",'<div class="name_right" style="float:left;width:50%;">',"<h3>Dr.Arpana Jain</h3>","<span></span>","</div>","</div>","</div>"].join("")},{xtype:"Medication-History",flex:1}],record:null},updateRecord:function(a){if(a){this.down("#medicationhistorycontent").setData(a.data)}}});Ext.define("RaxaEmr.Outpatient.view.patient.refertodoc",{extend:"Ext.ux.touch.grid.View",xtype:"Refer-To-Doc",requires:["Ext.ux.touch.grid.feature.Feature","Ext.field.Number","RaxaEmr.Outpatient.store.Grid"],config:{title:"Refer to Doctor",id:"refToDocPanel",items:[{xtype:"toolbar",docked:"top",items:[{xtype:"segmentedbutton",margin:"0 0 0 10",allowDepress:false,items:[{xtype:"button",text:"Sort By Drug Name",id:"reftodocsortbydocname",pressed:true,width:200,},{xtype:"button",id:"reftodocsortbyopdno",text:"Sort By OPD No.",width:200,}]},{xtype:"spacer"},{xtype:"button",id:"referpatient",text:"Refer",ui:"confirm",width:100,},{xtype:"searchfield",id:"reftodocsearchfield",placeHolder:"Search..."}]}],columns:[{header:"Doctor Name",dataIndex:"display",width:"50%",cls:"centered-cell",renderer:function(a){return a.split("- ")[1]}},{header:"Identifier",dataIndex:"identifier",width:"50%",cls:"centered-cell"}]}});Ext.define("RaxaEmr.Outpatient.view.patient.refertodocpanel",{extend:"Ext.Container",xtype:"Refer-To-Doc-Panel",requires:["RaxaEmr.Outpatient.view.patient.refertodoc"],config:{title:"Refer to Doctor",cls:"x-show-contact",layout:"vbox",items:[{id:"reftodoccontent",tpl:['<div class="top">','<div style="float:left;width:50%;">','<div class="headshot" style="float:left;background-image:url({image});">',"</div>",'<div class="name" style="float:left;width:80%;">',"{display}","</br>","<span>From : New Delhi, India</span>","</br>","</div>","</div>",'<div style="float:left;width:50%;">','<div class="name_small" style="float:left;width:50%;">',"<span> Age : {age} </span>","<span>ID : 16736127</span>","</br>","</div>",'<div class="name_right" style="float:left;width:50%;">',"<h3>Dr.Arpana Jain</h3>","<span></span>","</div>","</div>","</div>"].join("")},{xtype:"Refer-To-Doc",flex:1}],record:null},updateRecord:function(a){if(a){this.down("#reftodoccontent").setData(a.data)}}});Ext.define("RaxaEmr.Outpatient.view.patient.examination",{extend:"Ext.Container",xtype:"examination-panel",requires:["RaxaEmr.Outpatient.view.patient.examinationlist","RaxaEmr.Outpatient.view.patient.signlist"],id:"examination-panel",config:{layout:{type:"card"},title:"Examination",activeItem:0,items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",flex:1,layout:{type:"vbox"},items:[{xtype:"formpanel",border:"0 0 1 0",padding:"0 0 0 0",style:"border:solid #DADADA;",scrollable:false,height:93,items:[{xtype:"selectfield",label:"Search In",id:"signFilter",hidden:true,border:"0 0 1 0",style:"border:solid #DADADA;",valueField:"filterBy",displayField:"title",store:{data:[{filterBy:"all",title:"All",}]}},{xtype:"searchfield",id:"signfilterbysearchfield",}]},{xtype:"Sign-List",flex:1,}]},{xtype:"container",flex:1,items:[{xtype:"container",margin:"0 0 20 0",border:"0 0 0 3",style:"border:solid #DADADA;",height:576,layout:{type:"fit"},items:[{xtype:"Examination-List"},{xtype:"actionsheet",id:"durationPicker",hidden:true,items:[{xtype:"formpanel",height:100,width:"100%",items:[{xtype:"numberfield",label:"Duration",id:"durationfield"}]},{xtype:"toolbar",docked:"top",items:[{xtype:"button",text:"Save",id:"saveDuration"},{xtype:"spacer"},{xtype:"button",text:"Cancel",handler:function(){Ext.getCmp("durationPicker").setHidden(true)}}]}]}]}]}]}]}});Ext.define("RaxaEmr.Outpatient.view.patient.drugpanel",{extend:"Ext.ux.touch.grid.View",xtype:"Drug-Panel",store:"drugpanel",requires:["Ext.ux.touch.grid.feature.Feature"],config:{title:"Medication History",store:"drugpanel",columns:[{header:"Drug Name",dataIndex:"drugname",width:"25%",cls:"centered-cell",renderer:function(b,a){return"<span>"+b+"</span>"}},{header:"Strength",dataIndex:"strength",width:"25%",cls:"centered-cell",renderer:function(b,a){return"<span>"+b+" mg</span>"}},{header:"Dosage",dataIndex:"frequency",width:"25%",cls:"centered-cell",},{header:"Instruction",dataIndex:"instruction",width:"25%",cls:"centered-cell",}]}});Ext.define("RaxaEmr.Outpatient.view.patient.DrugGrid",{extend:"Ext.ux.touch.grid.View",xtype:"drug-grid",requires:["Ext.ux.touch.grid.feature.Feature","Ext.field.Number","RaxaEmr.Outpatient.store.drugpanel"],config:{title:"Drug Grid",store:"drugpanel",scrollable:"true",columns:[{header:"Drug Name",dataIndex:"drugname",width:"20%",cls:"centered-cell"},{header:"Strength",dataIndex:"strength",width:"15%",cls:"centered-cell",renderer:function(b,a){return"<span>"+b+" mg</span>"}},{header:"Frequency",dataIndex:"frequency",width:"15%",cls:"centered-cell"},{header:"Time of Intake",dataIndex:"instruction",width:"20%",cls:"centered-cell"},{header:"Route of Administration",dataIndex:"routeofadministration",width:"20%",cls:"centered-cell"},{header:"Duration",dataIndex:"duration",width:"10%",cls:"centered-cell",renderer:function(b,a){return"<span>"+b+" days</span>"}}]}});var TREATMENT={ADD:0,DRUGPANEL:1,};Ext.define("RaxaEmr.Outpatient.view.patient.treatment",{extend:"Ext.Container",xtype:"treatment-panel",requires:["RaxaEmr.Outpatient.view.patient.drugpanel","RaxaEmr.Outpatient.view.patient.treatmentsummery","Screener.store.druglist","Screener.model.druglist","RaxaEmr.Outpatient.view.patient.druglist","RaxaEmr.Outpatient.view.patient.drugform","RaxaEmr.Outpatient.view.patient.DrugGrid"],id:"treatment-panel",config:{layout:{type:"card"},title:"Treatment",activeItem:0,items:[{xtype:"drug-panel"},{xtype:"draw-panel"},{xtype:"container",items:[{xtype:"container",layout:"hbox",items:[{xtype:"button",height:40,margin:"20 20 0 0",width:"150",icon:"../outpatient/resources/images/add.png",text:"Add Drugs",padding:"0 10 10 0",handler:function(){Ext.getCmp("drugForm").setHidden(false);Ext.getCmp("drugaddform").reset();Ext.getCmp("treatment-panel").setActiveItem(TREATMENT.ADD)}},{xtype:"spacer",width:"0%"},{xtype:"button",ui:"confirm",height:40,margin:"20 20 0 0",width:"150",text:"Confirm Drug Order",padding:"0 10 10 0",handler:function(){drugOrderInDrugPanel=Ext.getStore("drugpanel");drugListStore=Ext.getStore("druglist");order=[];for(var l=0;l<drugOrderInDrugPanel.data.length;l++){for(var h=0;h<drugListStore.data.length;h++){if(drugOrderInDrugPanel.data.items[l].data.drugname==drugListStore.data.items[h].data.drug){var o=drugListStore.data.items[l].data.uuid;break}}concept=new Array();var f=drugOrderInDrugPanel.data.items[l].data.duration;var b=drugOrderInDrugPanel.data.items[l].data.strength;var g=drugOrderInDrugPanel.data.items[l].data.duration;var m=drugOrderInDrugPanel.data.items[l].data.frequency;var a=drugOrderInDrugPanel.data.items[l].data.instruction;Ext.Ajax.request({url:HOST+"/ws/rest/v1/concept?q="+drugOrderInDrugPanel.data.items[l].data.drugname,method:"GET",disableCaching:false,headers:Util.getBasicAuthHeaders(),failure:function(j){console.log("GET call on concept failed with response status"+j.status)},success:function(j){console.log("GET call on concept was successful with response status"+j.status);var r=JSON.parse(j.responseText);var q=new Date();var k=Util.Datetime(k,Util.getUTCGMTdiff());order.push({patient:Ext.getCmp("contact").selected.items[0].data.uuid,drug:o,startDate:q,autoExpireDate:new Date(q.getFullYear(),q.getMonth(),q.getDate()+f),dose:b,quantity:f,frequency:m,instructions:a,type:"drugorder",concept:r.results[0].uuid})}})}var n=new Date();var c=Util.Datetime(n,Util.getUTCGMTdiff());var p=Ext.create("RaxaEmr.Outpatient.model.drugEncounter",{patient:Ext.getCmp("contact").selected.items[0].data.uuid,encounterType:localStorage.outUuidencountertype,encounterDatetime:c,provider:localStorage.loggedInUser,orders:order});var e=Ext.create("RaxaEmr.Outpatient.store.drugEncounter");e.add(p);e.sync();var l=0;var h=0;var d=0}}]},{xtype:"drug-grid",id:"orderedDrugGrid",height:250,border:10,},]}]}});var TABS={HISTORY:0,EXAMINATION:1,DATA:2,DIAGNOSIS:3,TREATMENT:4};Ext.define("RaxaEmr.Outpatient.view.patient.work",{extend:"Ext.Container",xtype:"work",requires:["RaxaEmr.Outpatient.view.patient.history","RaxaEmr.Outpatient.view.patient.examination","RaxaEmr.Outpatient.view.patient.dataPanel","RaxaEmr.Outpatient.view.patient.treatment","RaxaEmr.Outpatient.view.patient.diagnosis","RaxaEmr.Outpatient.view.patient.draw"],config:{layout:{type:"hbox"},height:768,width:1024,items:[{xtype:"diagnosis-panel",id:"diagnosis-panel"},{xtype:"treatment-panel",},]}});Ext.define("RaxaEmr.Outpatient.view.patient.more",{extend:"Ext.Container",xtype:"patientlist-show",requires:["RaxaEmr.Outpatient.view.patient.Grid","RaxaEmr.Outpatient.view.patient.medicationhistory","RaxaEmr.Outpatient.view.patient.refertodoc","RaxaEmr.Outpatient.view.patient.work","RaxaEmr.Outpatient.view.patient.labresulthistory"],config:{title:"Outpatient Department",cls:"x-show-contact",ui:"round",id:"more",layout:"vbox",items:[{xtype:"container",height:96,layout:"hbox",items:[{id:"content",height:60,tpl:['<div class="top">','<div style="float:left;width:30%;">','<span class="headshot" style="float:left;background-image:url(resources/images/headshot.png);">',"</span>","</div>",'<div style="float:left;width:40%;">','<span class="name" style="float:left;">',"{display}","</span>","</div>",'<div style="float:left;width:30%;">','<div class="name_small" style="float:left;">',"<span>ID : --</span>","<span>Age : {age} </span>","<span>From : -- </span>","</div>","</div>","</div>"].join(""),flex:1,border:1,},{xtype:"vitalsGrid",margin:4,flex:1,}]},{xtype:"container",layout:{type:"card"},id:"working-area",flex:1,activeItem:0,items:[{xtype:"treatment-panel",},{xtype:"diagnosis-panel"}]}],record:null},updateRecord:function(a){if(a){this.down("#content").setData(a.data)}}});Ext.define("RaxaEmr.Outpatient.view.Viewport",{extend:"Ext.navigation.View",xtype:"mainview",id:"mainview",requires:["RaxaEmr.Outpatient.view.patientlist","RaxaEmr.Outpatient.view.patient.more","RaxaEmr.Outpatient.view.patient.labresulthistorypanel","RaxaEmr.Outpatient.view.patient.refertodocpanel","RaxaEmr.Outpatient.view.patient.medicationhistorypanel","RaxaEmr.Outpatient.view.patient.diagnosis"],config:{autoDestroy:false,fullscreen:true,navigationBar:{items:[{xtype:"button",id:"confirmmedicationhistory",text:"Done",ui:"confirm",align:"right",hidden:true},{xtype:"button",id:"confirmlabresulthistory",text:"Done",ui:"confirm",align:"right",hidden:true},{xtype:"button",id:"confirmrefertodoc",text:"Done",ui:"confirm",align:"right",hidden:true},]},items:[{xtype:"patientlist"}]}});Ext.Loader.setPath({"Ext.ux.touch.grid":"../lib/touch/Ext.ux.touch.grid",Screener:"../screener/app"});Ext.application({name:"RaxaEmr.Outpatient",requires:["Ext.MessageBox"],models:["patientlist","Grid","medicationhistory","refertodoc","labresulthistory","drugpanel","cheifcomplain","sign","diagnosis","diagnosedDisease","druglist","Observation","PostList"],stores:["patientlist","Grid","medicationhistory","refertodoc","labresulthistory","drugpanel","cheifcomplain","sign","diagnosis","diagnosedDisease","druglist","PostLists","PatientsList","obs"],views:["Main","Viewport"],controllers:["patientlist"],icon:{"57":"resources/icons/Icon.png","72":"resources/icons/Icon~ipad.png","114":"resources/icons/Icon@2x.png","144":"resources/icons/Icon~ipad@2x.png"},isIconPrecomposed:true,startupImage:{"320x460":"resources/startup/320x460.jpg","640x920":"resources/startup/640x920.png","768x1004":"resources/startup/768x1004.png","748x1024":"resources/startup/748x1024.png","1536x2008":"resources/startup/1536x2008.png","1496x2048":"resources/startup/1496x2048.png"},launch:function(){Ext.fly("appLoadingIndicator").destroy();Ext.Viewport.add(Ext.create("RaxaEmr.Outpatient.view.Viewport"))},onUpdated:function(){Ext.Msg.confirm("Application Update","This application has just successfully been updated to the latest version. Reload now?",function(a){if(a==="yes"){window.location.reload()}})}});